# xddNode - ComfyUI自定义节点集合

这是一个实用的ComfyUI自定义节点集合，提供了多种图像处理功能。目前包含以下节点：

1. **图像格式统一节点** - 将图像转换为统一格式
2. **图像重命名节点** - 批量重命名图像文件

## 功能特点

### 图像格式统一节点
- 支持转换为多种格式（PNG/JPEG/WebP）
- 可设置输出质量（对JPEG和WebP有效）
- 提供两种处理模式：
  - 单张图像处理：处理工作流中的图像
  - 文件夹批处理：处理整个文件夹的图像并保存到指定位置
- 批处理支持递归选项，可处理子文件夹中的图像
- 保持目录结构，输出与输入保持相同层次
- 提供详细的处理结果统计

### 图像重命名节点
- 支持多种命名模式：
  - 序号模式：按顺序编号命名
  - 时间戳模式：使用时间作为文件名
  - 前缀模式：为原始文件名添加前缀
  - 后缀模式：为原始文件名添加后缀
  - 完全自定义模式：自定义命名模板
- 支持预览重命名结果
- 支持保留/不保留原始扩展名
- 支持递归处理子文件夹
- 支持多种排序方式（按名称、修改时间、文件大小）

## 代码结构

这个插件采用模块化结构，便于维护和扩展：

```
custom_nodes/
└── xddNode/
    ├── __init__.py           # 主入口文件
    ├── marking_node.py       # 节点注册文件
    ├── nodes/                # 节点模块目录
    │   ├── __init__.py       # 节点模块初始化
    │   ├── format_node.py    # 格式转换节点
    │   └── image_rename_node.py # 图像重命名节点
    └── README.md             # 文档
```

## 安装方法

1. 将此插件目录放置在ComfyUI的`custom_nodes`目录下
2. 重启ComfyUI

## 使用方法

### 图像格式统一节点

#### 单张图像处理模式
1. 在ComfyUI工作流中，搜索并添加"统一图像格式"节点
2. 选择"单张图像处理"模式
3. 连接图像输入
4. 设置格式参数（输出格式、质量）
5. 运行工作流，即可得到统一格式后的图像

#### 文件夹批处理模式
1. 在ComfyUI工作流中，搜索并添加"统一图像格式"节点
2. 选择"文件夹批处理"模式
3. 设置输入/输出文件夹路径及格式参数
4. 运行工作流，节点会处理文件夹中所有图像

### 图像重命名节点

1. 在ComfyUI工作流中，搜索并添加"图像重命名"节点
2. 设置文件夹路径和命名模式
3. 选择"预览重命名"模式查看重命名效果
4. 满意后，切换到"批量重命名"模式执行重命名操作

## 参数说明

### 图像格式统一节点
- `mode`: 处理模式 (单张图像处理/文件夹批处理)
- `format`: 输出格式 (PNG/JPEG/WebP)
- `quality`: 输出质量 (1-100，仅对JPEG和WebP有效)
- `image`: 输入图像 (仅单张处理模式需要)
- `input_folder`: 输入文件夹路径 (仅批处理模式需要)
- `output_folder`: 输出文件夹路径 (仅批处理模式需要)
- `recursive`: 是否递归处理子文件夹 (是/否)

### 图像重命名节点
- `mode`: 处理模式 (预览重命名/批量重命名)
- `naming_pattern`: 命名模式 (序号/时间戳/原名+前缀/原名+后缀/完全自定义)
- `folder_path`: 图像文件夹路径
- `name_template`: 自定义命名模板 (支持变量：{number}, {timestamp}, {original})
- `start_number`: 起始编号 (用于序号模式)
- `digit_count`: 数字位数 (用于序号模式，如001、0001等)
- `prefix`: 前缀 (用于原名+前缀模式)
- `suffix`: 后缀 (用于原名+后缀模式)
- `preserve_extension`: 是否保留原扩展名 (是/否)
- `preserve_subfolders`: 是否保留子文件夹结构 (是/否)
- `sort_by`: 文件排序方式 (名称/修改时间/文件大小)
- `date_format`: 日期格式 (用于时间戳模式)
- `recursive`: 是否递归处理子文件夹 (是/否)
- `target_extensions`: 目标文件扩展名 (如.jpg,.png等)

## 开发与贡献

欢迎贡献新的功能或改进。如需添加新节点：
1. 在 `nodes/` 目录下创建新的节点文件
2. 在 `nodes/__init__.py` 中导入并导出新节点
3. 在 `marking_node.py` 中注册新节点到映射中

## 许可证

MIT 
